const STARTUP_LISTENER_ORDER = 50;

class ServerConfigurator {
  constructor() {
    this.order = STARTUP_LISTENER_ORDER;
  }

  /**
   * Startup listener which provides default uuApp server configuration.
   */
  onStartup() {
    let { Config } = require("uu_appg01_core-utils");

    // Configure authentication
    let Authn = require("uu_appg01_core-authentication");
    if (!Config.hasKey(Authn.AuthenticationService.DEFAULT_PROVIDER_PARAM)) {
      // Configure default authentication service
      require("uu_appg01_oidc").OidcAuthenticationService;
      Config.set(Authn.AuthenticationService.DEFAULT_PROVIDER_PARAM, "uu_appg01_oidc");
    }

    // Configure authorization
    let Authz = require("uu_appg01_core-authorization");
    if (!Config.hasKey(Authz.AuthorizationService.DEFAULT_PROVIDER_PARAM)) {
      // Configure default authorization service
      require("uu_appg01_workspace").WorkspaceAuthorizationService;
      Config.set(Authz.AuthorizationService.DEFAULT_PROVIDER_PARAM, "uu_appg01_workspace");
    }
  }
}

module.exports = ServerConfigurator;
