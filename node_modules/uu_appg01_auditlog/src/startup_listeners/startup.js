const { DaoFactory } = require("uu_appg01_objectstore");
const { Config } = require("uu_appg01_core-utils");

class Startup {
  /**
   * Initializing auditLog schemas on server start.
   */
  async onStartup() {
    if (DaoFactory.isDataStoreOn()) {
      const dao = require("../abl/sys-audit-log-abl.js").dao;
      const configDao = require("../abl/sys-audit-log-abl.js").configDao;
      await dao.createSchema();
      await configDao.createSchema();

      // create auditLogConfig if it does not exist
      const asid = Config.get("asid");
      let asidConfig = await configDao.getByAwid(asid);
      if (!asidConfig) {
        asidConfig = { awid: asid, latestTransferredLogId: null, latestTransferDate: null, latestTransferState: null };
        await configDao.create(asidConfig);
      }
    }
  }
}

module.exports = Startup;
