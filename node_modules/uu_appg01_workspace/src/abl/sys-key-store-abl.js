"use strict";

const SysAppSecretStoreAbl = require("../abl/sys-app-secret-store-abl.js");

class SysKeyStoreAbl {

  /**
   * @deprecated
   * Old implementation of uuAppKey, left for backward compatibility.
   * Use UuAppSecretStore.putSecret component instead.
   */
  async putKey(awid, keySet, keyCode, key) {
    console.error(
      "DEPRECATED: SysKeyStoreAbl.putKey in uuAppWorkspace library is deprecated, please use UuAppSecretStore.putSecret component instead."
    );
    let entry = await SysAppSecretStoreAbl.putSecret(awid, keySet, keyCode, key);
    return { id: entry.id, sys: entry.sys, awid, keySet, keyCode, key };
  }

  /**
   * @deprecated
   * Old implementation of uuAppKey, left for backward compatibility.
   * Use UuAppSecretStore.getSecret component instead.
   */
  async getKey(awid, keySet, keyCode) {
    console.error(
      "DEPRECATED: SysKeyStoreAbl.getKey in uuAppWorkspace library is deprecated, please use UuAppSecretStore.getSecret component instead."
    );
    let entry = await SysAppSecretStoreAbl.getSecret(awid, keySet, keyCode, true);
    return entry ? { id: entry.id, sys: entry.sys, awid, keySet, keyCode, key: entry.secret } : null;
  }

  /**
   * @deprecated
   * Old implementation of uuAppKey, left for backward compatibility.
   * Use UuAppSecretStore.listSecretCodes component instead.
   */
  async listKeys(awid, keySet) {
    console.error(
      "DEPRECATED: SysKeyStoreAbl.listKeys in uuAppWorkspace library is deprecated, please use UuAppSecretStore.listSecretCodes component instead."
    );
    let itemList = [];
    let keyCodes = await SysAppSecretStoreAbl.listSecretCodes(awid, keySet);
    for (let keyCode in keyCodes) {
      let entry = await SysAppSecretStoreAbl.getSecret(awid, keySet, secretCode, true);
      if (entry) {
        itemList.push({ id: entry.id, sys: entry.sys, awid, keySet, keyCode, key: entry.secret });
      }
    }
    let pageInfo = { pageIndex: 0, pageSize: itemList.length, total: itemList.length };
    return { pageInfo, itemList };
  }
}

module.exports = new SysKeyStoreAbl();
