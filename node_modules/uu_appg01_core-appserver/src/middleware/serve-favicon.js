"use strict";

const ExpressServeFavicon = require("serve-favicon");
const fs = require("fs");
const { Config } = require("uu_appg01_core-utils");
const Path = require("path");

const MIDDLEWARE_ORDER = -250;
const PROFILES = "development";

/**
 * Serves favicon.ico using Express recommended serve-favicon.
 */
class ServeFavicon {
  constructor() {
    this.order = MIDDLEWARE_ORDER;
    this.profiles = PROFILES;
    this._root = Config.get("server_root");
  }

  /**
   * Getter that returns Express compliant middleware function.
   * @returns {Function}
   */
  get pre() {
    let path = Path.join(this._root, "public", "favicon.ico");
    if (fs.existsSync(path)) {
      return ExpressServeFavicon(path);
    } else {
      return ExpressServeFavicon(Path.join(__dirname, "..", "views", "favicon.ico"));
    }
  }
}

/**
 * Module exports ServeFavicon constructor.
 * @type {ServeFavicon}
 */
module.exports = ServeFavicon;
