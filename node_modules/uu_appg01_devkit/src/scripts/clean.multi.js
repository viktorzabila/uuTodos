const path = require("path");
const { exec, resolveByTemplateType } = require("../tools/helpers.js");
const Clean = require("./clean.js");

module.exports = class CleanMulti extends Clean {
  constructor(config) {
    super(config);
  }

  async process() {
    await super.process();

    let modules = this.config.getWorkspaceLibraryList();
    console.log("Cleaning projects: " + modules.map((it) => it.name).join(", "));

    for (let { name, pkg, type } of modules) {
      if (!pkg.scripts.clean || resolveByTemplateType(path.join(__dirname, "clean.js"), type) == null) continue;
      await exec("npm run clean -- " + this.config.toCommandLineArgs().join(" "), { cwd: path.resolve(name) }); // TODO Escaping of arguments
    }
  }
};
