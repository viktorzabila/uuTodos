const DeployLib = require("./deploy.lib.js");

module.exports = class DeployMulti extends DeployLib {
  constructor(config) {
    super(config);
  }

  async process() {
    let { cdnDeploy, uuCloudDeploy } = this.config.getAll();

    // if deploying combination of libraries with no explicit options, decide whether to do uuCloud
    // deployment
    if (typeof cdnDeploy === "undefined" && typeof uuCloudDeploy === "undefined") {
      let modules = this.config.getWorkspaceLibraryList();
      let needsUuCloud = modules.some((it) => it.type === "lib" || it.type === "uu5-lib");
      uuCloudDeploy = needsUuCloud;
      this.config.set({ uuCloudDeploy });
    }

    await super.process();
  }
};
