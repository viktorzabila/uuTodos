const path = require("path");
const { exec, resolveByTemplateType } = require("../tools/helpers.js");

module.exports = class Prettify {
  constructor(config) {
    this.config = config;
  }

  async process() {
    let modules = this.config.getWorkspaceLibraryList();
    console.log("Prettifying projects: " + modules.map((it) => it.name).join(", "));

    for (let { name, pkg, type } of modules) {
      if (!pkg.scripts.prettify || resolveByTemplateType(path.join(__dirname, "prettify.js"), type) == null) continue;
      await exec("npm run prettify -- " + this.config.toCommandLineArgs().join(" "), { cwd: path.resolve(name) }); // TODO Escaping of arguments
    }
  }
};
