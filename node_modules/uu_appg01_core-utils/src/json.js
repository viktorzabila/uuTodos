"use strict";

const POLLUTION_CHECK = /"(((_|\\u005f)(_|\\u005f)(p|\\u0070)(r|\\u0072)(o|\\u006f)(t|\\u0074)(o|\\u006f)(_|\\u005f)(_|\\u005f))|((c|\\u0063)(o|\\u006[Ff])(n|\\u006[Ee])(s|\\u0073)(t|\\u0074)(r|\\u0072)(u|\\u0075)(c|\\u0063)(t|\\u0074)(o|\\u006[Ff])(r|\\u0072)))"/;
const PROTO_KEY = "__proto__";
const CONSTRUCTOR_KEY = "constructor";

class Json {

  static parse(text, secure = true) {
    if (secure && POLLUTION_CHECK.test(text)) {
      return JSON.parse(text, (key, value) => key !== PROTO_KEY && key !== CONSTRUCTOR_KEY ? value : undefined);
    } else {
      return JSON.parse(text);
    }
  }

  static stringify(value, prettyPrint = false) {
    if (prettyPrint) {
      return JSON.stringify(value, null, 2);
    } else {
      return JSON.stringify(value);
    }
  }

}

module.exports = Json;
